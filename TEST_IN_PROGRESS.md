# ğŸ¯ æœ€çµ‚ãƒ†ã‚¹ãƒˆ - å®Ÿæ–½ä¸­

## ğŸ“± ãƒ†ã‚¹ãƒˆå®Ÿæ–½çŠ¶æ³

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:** ãƒ†ã‚¹ãƒˆå®Ÿæ–½ä¸­  
**é–‹å§‹æ™‚åˆ»:** 2025-11-08

---

## âœ… ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

### è¨¼â‘  (å³æ™‚): å—é ˜ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
**ã‚¿ã‚¤ãƒŸãƒ³ã‚°:** å‹•ç”»é€ä¿¡å¾Œã€æ•°ç§’ä»¥å†…  
**ç¢ºèªæ–¹æ³•:** LINEã‚¢ãƒ—ãƒªã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª

**æœŸå¾…ã•ã‚Œã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
å‹•ç”»ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸï¼AIãŒè§£æã‚’é–‹å§‹ã—ã¾ã™ã€‚

çµæœãŒå±Šãã¾ã§ã€ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„â€¦

â€»è§£æã¯20ç§’ä»¥å†…/100MBä»¥ä¸‹ã®å‹•ç”»ãŒå¯¾è±¡ã§ã™ã€‚
```

---

### è¨¼â‘¡ (ãƒ­ã‚°): processVideoJobã®å®Ÿè¡Œç¢ºèª
**ã‚¿ã‚¤ãƒŸãƒ³ã‚°:** å‹•ç”»é€ä¿¡å¾Œã€1-2åˆ†ä»¥å†…  
**ç¢ºèªæ–¹æ³•:** ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ä»¥ä¸‹ã‚’å®Ÿè¡Œ

**ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ï¼ˆæ¨å¥¨ï¼‰:**
```bash
./watch_logs.sh
```

**ã¾ãŸã¯ã€ä¸€åº¦ã ã‘ç¢ºèª:**
```bash
./test_logs.sh
```

**æœŸå¾…ã•ã‚Œã‚‹ãƒ­ã‚°:**
- `processVideoJobé–‹å§‹: jobId=..., lineUserId=..., videoUrl=...`
- `processVideoJobæˆåŠŸ: {"answer":"...","conversation_id":"..."}`

---

### è¨¼â‘¢ (æœ€çµ‚çµæœ): LINEãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
**ã‚¿ã‚¤ãƒŸãƒ³ã‚°:** å‹•ç”»é€ä¿¡å¾Œã€1-3åˆ†ä»¥å†…  
**ç¢ºèªæ–¹æ³•:** LINEã‚¢ãƒ—ãƒªã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª

**æœŸå¾…ã•ã‚Œã‚‹çµæœ:**

**æ­£å¸¸ã‚±ãƒ¼ã‚¹:**
- Difyã‹ã‚‰ã®è§£æçµæœï¼ˆä¾‹: ã€Œã“ã®å‹•ç”»ã§ã¯ã€ã‚­ãƒƒã‚¯ãƒœã‚¯ã‚·ãƒ³ã‚°ã®ãƒ•ã‚©ãƒ¼ãƒ ãŒ...ã€ï¼‰

**Dify API 500ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹:**
- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆä¾‹: ã€Œå‹•ç”»ã®è§£æã‚µãƒãƒªãƒ¼: Dify APIã§ä¸€æ™‚çš„ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚å¾Œã»ã©å®Œå…¨ç‰ˆã‚’é€ä¿¡ã—ã¾ã™ã€‚ã€ï¼‰

---

## ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœè¨˜éŒ²

ãƒ†ã‚¹ãƒˆå®Ÿæ–½å¾Œã€ä»¥ä¸‹ã‚’è¨˜éŒ²ã—ã¦ãã ã•ã„ï¼š

- **ãƒ†ã‚¹ãƒˆæ—¥æ™‚:** 
- **å‹•ç”»å½¢å¼:** mp4
- **å‹•ç”»ã‚µã‚¤ã‚º:** MB
- **å‹•ç”»é•·ã•:** ç§’
- **è¨¼â‘  (å—é ˜ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸):** âœ… / âŒ
- **è¨¼â‘¡ (ãƒ­ã‚°å‡ºåŠ›):** âœ… / âŒ
- **è¨¼â‘¢ (æœ€çµ‚çµæœ):** âœ… / âŒ
- **çµæœãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:** ï¼ˆå±Šã„ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å†…å®¹ï¼‰
- **å‚™è€ƒ:** 

---

## ğŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### è¨¼â‘ ãŒå±Šã‹ãªã„å ´åˆ
```bash
# lineWebhookRouterã®ãƒ­ã‚°ã‚’ç¢ºèª
gcloud logging read 'resource.type="cloud_run_revision" AND resource.labels.service_name="linewebhookrouter" AND textPayload=~"å‹•ç”»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"' \
  --limit=10 \
  --format="table(timestamp,severity,textPayload)" \
  --project=aikaapp-584fa \
  --freshness=10m
```

### è¨¼â‘¡ã®ãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œãªã„å ´åˆ
```bash
# ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ç¢ºèª
gcloud logging read 'severity>=ERROR AND (resource.labels.service_name="processvideojob" OR resource.labels.service_name="linewebhookrouter")' \
  --limit=10 \
  --format="json" \
  --project=aikaapp-584fa \
  --freshness=10m
```

### è¨¼â‘¢ãŒå±Šã‹ãªã„å ´åˆ
```bash
# Dify APIã®ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ç¢ºèª
gcloud logging read 'textPayload=~"Dify API 500ã‚¨ãƒ©ãƒ¼" OR textPayload=~"Dify blocking error"' \
  --limit=10 \
  --format="table(timestamp,severity,textPayload)" \
  --project=aikaapp-584fa \
  --freshness=10m

# LINEé€ä¿¡ã®ãƒ­ã‚°ã‚’ç¢ºèª
gcloud logging read 'textPayload=~"sendLineMessage" OR textPayload=~"LINEãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡æˆåŠŸ" OR textPayload=~"LINE push error"' \
  --limit=10 \
  --format="table(timestamp,severity,textPayload)" \
  --project=aikaapp-584fa \
  --freshness=10m
```

---

## ğŸ‰ æˆåŠŸã®åŸºæº–

ä»¥ä¸‹ã®3ã¤ã™ã¹ã¦ãŒç¢ºèªã§ãã‚Œã°ã€**å®Œå…¨æˆåŠŸ**ã§ã™ï¼š

1. âœ… è¨¼â‘ : å—é ˜ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå±Šã
2. âœ… è¨¼â‘¡: Cloud Loggingã§`processVideoJobé–‹å§‹`ã¨`processVideoJobæˆåŠŸ`ã®ãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã‚‹
3. âœ… è¨¼â‘¢: LINEã«Difyã‹ã‚‰ã®è§£æçµæœã€ã¾ãŸã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå±Šã

---

**æœ€çµ‚æ›´æ–°:** 2025-11-08  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:** ãƒ†ã‚¹ãƒˆå®Ÿæ–½ä¸­ â³


# ✅ 動作確認テストケース

## 📋 テスト項目

### 1. 動画アップロードのテスト

#### テストケース1: 正常な動画（20秒以内、100MB以下）
- **入力**: 20秒以内、100MB以下の動画
- **期待結果**: 
  - 「動画を受け付けました！」メッセージが返る
  - 解析が実行される
  - 解析結果が返る

#### テストケース2: 動画が20秒超過
- **入力**: 25秒の動画
- **期待結果**: 
  - 「…チッ、動画が長すぎるわよ！今の動画は25.0秒じゃない。20秒以内に収めなさい。」
  - 英語版も含まれる
  - 解析は実行されない

#### テストケース3: 動画が100MB超過
- **入力**: 150MBの動画
- **期待結果**: 
  - 「…チッ、動画ファイルが大きすぎるわよ！今の動画は150.0MBじゃない。100MB以下に収めなさい。」
  - 英語版も含まれる
  - 解析は実行されない

#### テストケース4: 動画処理エラー
- **入力**: 破損した動画ファイル
- **期待結果**: 
  - 「…チッ、動画の処理中にエラーが発生したわ。もう一度送り直してみなさい。」
  - 英語版も含まれる

---

### 2. テキストメッセージのテスト

#### テストケース5: 正常なテキストメッセージ
- **入力**: 「こんにちは」
- **期待結果**: 
  - AIKA18号からの返信が返る
  - 日本語と英語の両方で返信
  - 会話IDが保存される

#### テストケース6: 悩み相談（痩せない）
- **入力**: 「最近太ってきちゃった…」
- **期待結果**: 
  - ツンデレ口調で返信
  - 運動やジムの話題が出る
  - 自然にジムへ誘導

#### テストケース7: 悩み相談（恋愛）
- **入力**: 「恋愛がうまくいかない…」
- **期待結果**: 
  - ツンデレ口調で返信
  - 自信をつけるために運動を提案
  - ジムへの誘導

#### テストケース8: 悩み相談（人間関係）
- **入力**: 「人間関係でストレスが…」
- **期待結果**: 
  - ツンデレ口調で返信
  - ストレス発散に運動を提案
  - ジムへの誘導

#### テストケース9: Dify APIエラー時
- **入力**: テキストメッセージ（Dify APIがエラーを返す場合）
- **期待結果**: 
  - 「申し訳ございません。AIの応答を取得できませんでした。しばらくしてから再度お試しください。」
  - エラーがログに記録される

---

### 3. セキュリティテスト

#### テストケース10: API連打攻撃
- **入力**: 1時間に10回以上の動画アップロード
- **期待結果**: 
  - 5回目以降は拒否される
  - 「…チッ、アンタ、ちょっとやりすぎじゃない？1時間あたり5回までよ。」メッセージが返る

#### テストケース11: 不正なWebhookリクエスト
- **入力**: 署名が不正なリクエスト
- **期待結果**: 
  - 401 Unauthorizedが返る
  - 処理が実行されない

---

## 🔧 テスト実行方法

### 手動テスト

1. **動画アップロードテスト**
   - LINEアプリから動画を送信
   - 各テストケースを実行

2. **テキストメッセージテスト**
   - LINEアプリからテキストメッセージを送信
   - 各テストケースを実行

3. **セキュリティテスト**
   - レートリミット: 短時間で複数回送信
   - Webhook署名: 不正なリクエストを送信（curl等で）

### 自動テスト（オプション）

```bash
# テストスクリプトを作成（将来の拡張用）
# test_line_webhook.sh
```

---

## 📊 テスト結果記録

### テスト実行日: [日付]

| テストケース | 結果 | 備考 |
|------------|------|------|
| 1. 正常な動画 | ✅ / ❌ | |
| 2. 20秒超過 | ✅ / ❌ | |
| 3. 100MB超過 | ✅ / ❌ | |
| 4. 動画処理エラー | ✅ / ❌ | |
| 5. 正常なテキスト | ✅ / ❌ | |
| 6. 痩せない悩み | ✅ / ❌ | |
| 7. 恋愛の悩み | ✅ / ❌ | |
| 8. 人間関係の悩み | ✅ / ❌ | |
| 9. Dify APIエラー | ✅ / ❌ | |
| 10. API連打攻撃 | ✅ / ❌ | |
| 11. 不正なWebhook | ✅ / ❌ | |

---

## ✅ 動作確認チェックリスト

- [ ] 全てのテストケースが実行された
- [ ] 全てのエラーケースでメッセージが返る
- [ ] 動画が20秒超過時に適切なメッセージが返る
- [ ] 動画が100MB超過時に適切なメッセージが返る
- [ ] テキストメッセージでDify APIが正しく動作する
- [ ] 会話の継続性が保たれる
- [ ] レートリミットが正しく動作する
- [ ] Webhook署名検証が正しく動作する

---

**重要**: 本番環境にデプロイする前に、全てのテストケースを実行してください。


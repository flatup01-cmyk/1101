# âœ… æºå¸¯ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼ä¿®æ­£ - æœ€çµ‚ç¢ºèªãƒ¬ãƒãƒ¼ãƒˆ

## ğŸ” å®Ÿè£…æ¸ˆã¿ä¿®æ­£å†…å®¹ã®ç¢ºèª

### 1ï¸âƒ£ Storage Rulesä¿®æ­£ âœ… **å®Ÿè£…æ¸ˆã¿**

**ç¾åœ¨ã®å®Ÿè£…**:
```firebase
// videos/{firebaseUid}/{jobId}/{filename} ã®3éšå±¤ãƒ‘ã‚¹æ§‹é€ ã«å¯¾å¿œ
match /videos/{firebaseUid}/{jobId}/{filename} {
  allow write: if request.auth != null
               && request.auth.uid == firebaseUid
               && filename.matches('.*\\.(mp4|mov|avi|mkv|MP4|MOV|AVI|MKV)$')
               && request.resource.size < 100 * 1024 * 1024;
}
```

**ç¢ºèªé …ç›®**:
- âœ… 3éšå±¤ãƒ‘ã‚¹æ§‹é€ ã«å¯¾å¿œæ¸ˆã¿
- âœ… å¤§æ–‡å­—ã®æ‹¡å¼µå­ã‚‚ã‚µãƒãƒ¼ãƒˆï¼ˆ.MP4, .MOVãªã©ï¼‰
- âœ… 2éšå±¤ãƒ‘ã‚¹ã‚‚å¾Œæ–¹äº’æ›æ€§ã®ãŸã‚ã‚µãƒãƒ¼ãƒˆ
- âœ… åŒ¿åèªè¨¼ã§ã‚‚å‹•ä½œã™ã‚‹ã‚ˆã†ã«è¨­å®šæ¸ˆã¿

---

### 2ï¸âƒ£ Firestoreæ¥ç¶šã®æ”¹å–„ âœ… **å®Ÿè£…æ¸ˆã¿**

**ç¾åœ¨ã®å®Ÿè£…** (`src/firebase.js`):
- âœ… 30ç§’ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’è¿½åŠ 
- âœ… ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½ï¼ˆæœ€å¤§3å›ï¼‰
- âœ… è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ­ã‚°
- âœ… ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰åˆ¥ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:
  - `permission-denied` â†’ æ¨©é™ã‚¨ãƒ©ãƒ¼
  - `unavailable` â†’ ã‚µãƒ¼ãƒ“ã‚¹åˆ©ç”¨ä¸å¯
  - ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ â†’ ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼

**ç¢ºèªé …ç›®**:
- âœ… `createVideoJob`é–¢æ•°ã«ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå®Ÿè£…æ¸ˆã¿
- âœ… ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…æ¸ˆã¿
- âœ… ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ…‹ã®ç›£è¦–å®Ÿè£…æ¸ˆã¿

---

### 3ï¸âƒ£ å‹•ç”»ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã®æ”¹å–„ âœ… **å®Ÿè£…æ¸ˆã¿**

**ç¾åœ¨ã®å®Ÿè£…** (`src/main.js` - `getVideoDuration`é–¢æ•°):
- âœ… ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: 60ç§’ã«å»¶é•·
- âœ… è©³ç´°ãªãƒ­ã‚°å‡ºåŠ›ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã€ã‚¿ã‚¤ãƒ—ï¼‰
- âœ… MediaErrorã‚³ãƒ¼ãƒ‰åˆ¥ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:
  - `MEDIA_ERR_ABORTED` â†’ èª­ã¿è¾¼ã¿ä¸­æ–­
  - `MEDIA_ERR_NETWORK` â†’ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼
  - `MEDIA_ERR_DECODE` â†’ ãƒ‡ã‚³ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼
  - `MEDIA_ERR_SRC_NOT_SUPPORTED` â†’ ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„å½¢å¼
- âœ… ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®é‡è¤‡å‡¦ç†é˜²æ­¢
- âœ… ãƒªã‚½ãƒ¼ã‚¹ã®ç¢ºå®Ÿãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

**ç¢ºèªé …ç›®**:
- âœ… ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: 60ç§’ âœ…
- âœ… è©³ç´°ãªãƒ­ã‚°å‡ºåŠ› âœ…
- âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ– âœ…

---

### 4ï¸âƒ£ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å¼·åŒ– âœ… **å®Ÿè£…æ¸ˆã¿**

**ç¾åœ¨ã®å®Ÿè£…** (`src/firebase.js` - `uploadVideoToStorage`é–¢æ•°):
- âœ… èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã®å¼·åˆ¶ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
- âœ… èªè¨¼çŠ¶æ…‹ã®è©³ç´°ãªãƒ­ã‚°å‡ºåŠ›
- âœ… 10%åˆ»ã¿ã®é€²æ—ãƒ­ã‚°å‡ºåŠ›
- âœ… ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰åˆ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:
  - `storage/unauthorized` â†’ èªè¨¼ã‚¨ãƒ©ãƒ¼
  - `storage/canceled` â†’ ã‚­ãƒ£ãƒ³ã‚»ãƒ«
  - `storage/quota-exceeded` â†’ å®¹é‡ä¸è¶³
  - `storage/unauthenticated` â†’ èªè¨¼ãŒå¿…è¦
  - `storage/retry-limit-exceeded` â†’ ãƒªãƒˆãƒ©ã‚¤è¶…é
- âœ… ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰é€Ÿåº¦ã¨æ®‹ã‚Šæ™‚é–“ã®è¡¨ç¤º
- âœ… ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå‡¦ç†ã®æ”¹å–„ï¼ˆé€²è¡Œä¸­ã¯å»¶é•·ï¼‰

**ç¢ºèªé …ç›®**:
- âœ… é€²æ—è¡¨ç¤ºã®è©³ç´°åŒ– âœ…
- âœ… ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰åˆ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ âœ…
- âœ… èªè¨¼çŠ¶æ…‹ã®ç¢ºèª âœ…

---

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤çŠ¶æ³

- âœ… Storage Rules: Firebaseã«ãƒ‡ãƒ—ãƒ­ã‚¤æ¸ˆã¿
- âœ… Firestore Rules: Firebaseã«ãƒ‡ãƒ—ãƒ­ã‚¤æ¸ˆã¿
- âœ… ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰: GitHubã«ãƒ—ãƒƒã‚·ãƒ¥æ¸ˆã¿
- âœ… Netlify: è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ä¸­

---

## ğŸ“± å‹•ä½œç¢ºèªæ‰‹é †

### 1. Netlifyã®ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†ã‚’å¾…ã¤ï¼ˆç´„2-3åˆ†ï¼‰

### 2. ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒ†ã‚¹ãƒˆ

**ç¢ºèªã™ã¹ãã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°**:
```
âœ… Firebase Core Services Initialized
ğŸš€ Initializing Firebase...
âœ… Anonymous Auth Success (XXXms)
ğŸ“‹ Current user: [UID]
âœ… Firebase initialization complete (XXXms)
ğŸ“Š Initial metrics: {...}
âœ… LIFF profile retrieved: [USER_ID]
ğŸ“¹ Loading video metadata for file: [filename] (X.XXMB, type: video/mp4)
âœ… Video metadata loaded: [duration]s
ğŸ“ Creating job (attempt 1/3) - Firebase UID: [UID], LIFF User ID: [USER_ID]
âœ… Job created in Firestore with ID: [JOB_ID] (XXXms)
ğŸš€ Starting upload for job [JOB_ID] to videos/[UID]/[JOB_ID]/[filename]
ğŸ“‹ Auth token retrieved: [token]...
ğŸ“‹ Auth UID matches path: YES
ğŸ“Š Upload progress: 10% | Speed: X.XXMB/s | ETA: XXs
ğŸ“Š Upload progress: 20% | Speed: X.XXMB/s | ETA: XXs
...
âœ… Upload complete for job [JOB_ID]
ğŸ“Š Upload metrics: X.XXMB in X.Xs (avg X.XXMB/s)
```

### 3. ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸå ´åˆã®ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

1. **403 Forbiddenã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹å ´åˆ**:
   - âœ… `ğŸ“‹ Auth token retrieved:` ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
   - âœ… `ğŸ“‹ Auth UID matches path: YES` ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
   - âœ… Firebase Consoleã§åŒ¿åèªè¨¼ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª

2. **å‹•ç”»èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹å ´åˆ**:
   - âœ… `ğŸ“¹ Loading video metadata for file:` ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
   - âœ… ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—ãŒæ­£ã—ã„ã‹ç¢ºèªï¼ˆvideo/mp4ãªã©ï¼‰
   - âœ… `âœ… Video metadata loaded:` ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

3. **Firestoreã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹å ´åˆ**:
   - âœ… `ğŸ“ Creating job` ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
   - âœ… `âœ… Job created in Firestore with ID:` ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
   - âœ… Firestore RulesãŒæ­£ã—ããƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

---

## âœ… ä¿®æ­£å®Œäº†ç¢ºèª

ã™ã¹ã¦ã®ä¿®æ­£ãŒå®Ÿè£…æ¸ˆã¿ã§ã™:

- âœ… Storage Rulesã®3éšå±¤ãƒ‘ã‚¹å¯¾å¿œ
- âœ… Firestoreæ¥ç¶šã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã¨ãƒªãƒˆãƒ©ã‚¤
- âœ… å‹•ç”»ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã®æ”¹å–„ï¼ˆ60ç§’ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼‰
- âœ… ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å¼·åŒ–
- âœ… èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã®ç¢ºèªã¨ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
- âœ… è©³ç´°ãªãƒ­ã‚°å‡ºåŠ›

---

## ğŸ¯ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **Netlifyã®ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†ã‚’å¾…ã¤**ï¼ˆç´„2-3åˆ†ï¼‰
2. **ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿**ï¼ˆCtrl+R / Cmd+Rï¼‰
3. **å‹•ç”»ã‚’é¸æŠã—ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**
4. **ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’ç¢ºèª**

ã™ã¹ã¦ã®ä¿®æ­£ãŒå®Œäº†ã—ã€ãƒ‡ãƒ—ãƒ­ã‚¤ã‚‚å®Œäº†ã—ã¦ã„ã¾ã™ã€‚Netlifyã®ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†å¾Œã€å†åº¦ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„ã€‚


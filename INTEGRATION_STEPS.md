# 📚 LIFFアプリとバックエンド統合ガイド（中学生向け）

## 🎯 目標

**ユーザーが動画をアップロード → AIKAが自動で分析 → LINEに結果を送る**

この流れを完成させます！

---

## 📋 全体の流れ（図解）

```
┌─────────────┐
│  ユーザー   │ 動画を選択
└──────┬──────┘
       │
       ↓
┌─────────────────┐
│  LIFFアプリ     │ 動画をアップロード
│  (フロントエンド)│
└──────┬──────────┘
       │ Firebase Storageに保存
       ↓
┌─────────────────┐
│ Firebase Storage│ 動画ファイル保存
└──────┬──────────┘
       │ 自動でトリガー
       ↓
┌─────────────────┐
│ Cloud Functions │ Pythonスクリプト実行
│  (バックエンド) │ MediaPipeで解析
└──────┬──────────┘
       │ 解析結果（JSON）
       ↓
┌─────────────────┐
│   Dify API      │ AIKAのセリフ生成
└──────┬──────────┘
       │ AIKAのメッセージ
       ↓
┌─────────────────┐
│ LINE Messaging  │ ユーザーに送信
│      API        │
└──────┬──────────┘
       │
       ↓
┌─────────────┐
│  ユーザー   │ LINEで結果を受け取る✨
└─────────────┘
```

---

## 🛠️ ステップ1: バックエンドを完成させる

### ステップ1-1: 解析結果をJSONで出力するように改造

現在の`analyze_video.py`は、コンソールに出力するだけです。
これを**JSONファイル**で出力するように改造します。

**なぜ？**
→ Cloud Functions（サーバー）で結果を受け取れるようにするため

**やり方：**

1. `analyze_video.py`を開く
2. 解析結果を辞書（dictionary）にまとめる
3. JSONファイルとして保存する

---

## 🛠️ ステップ2: Cloud Functionsを準備する

### ステップ2-1: functionsフォルダを作る

Cloud Functionsは**特別なフォルダ構造**が必要です。

**フォルダ構造：**
```
1101 new/
├── functions/          ← 新しく作る
│   ├── main.py         ← Cloud Functionsのコード
│   ├── requirements.txt ← Pythonのライブラリリスト
│   └── analyze.py      ← 動画解析のロジック
```

### ステップ2-2: requirements.txtを作る

必要なPythonライブラリをリストアップします。

---

## 🛠️ ステップ3: Cloud Functionsのコードを書く

### ステップ3-1: トリガー設定

Firebase Storageに動画が保存されたら、自動で動くようにします。

**トリガーとは？**
→ 「何かが起きたとき、自動でこのプログラムを実行して」という設定

### ステップ3-2: 動画をダウンロード

Cloud Storageから動画ファイルを取得します。

### ステップ3-3: 解析実行

既に作った`analyze_video.py`のロジックを使います。

---

## 🛠️ ステップ4: Dify APIと連携する

### ステップ4-1: Dify APIの設定

DifyのAPIエンドポイントとAPIキーを設定します。

**Difyとは？**
→ AIKAのセリフを自動生成してくれるAIサービス

### ステップ4-2: 解析結果を送信

解析結果（パンチ速度、キック角度など）をDifyに送ります。

### ステップ4-3: AIKAのセリフを受け取る

Difyが生成したAIKAのメッセージを受け取ります。

---

## 🛠️ ステップ5: LINE Messaging APIで送信

### ステップ5-1: LINE APIの設定

LINE Messaging APIのアクセストークンを設定します。

### ステップ5-2: メッセージを送信

Difyから受け取ったAIKAのセリフを、ユーザーにLINEで送ります。

---

## ✅ 完成！

すべてのステップが終わると：
1. ユーザーが動画をアップロード
2. 自動で解析される
3. AIKAが結果をLINEで送ってくれる

---

## 📝 次のステップ

どれから始めますか？

**A. ステップ1**: バックエンドの解析結果をJSON化
**B. ステップ2**: Cloud Functionsのフォルダ準備
**C. すべて順番に**: ステップ1から順番に進める


# 🎓 統合の仕組みをわかりやすく解説

## 📚 ステップ1が完了しました！

**作ったもの：**
- ✅ `functions/` フォルダ
- ✅ `functions/main.py` - Cloud Functionsのメインコード
- ✅ `functions/analyze.py` - 動画解析ロジック
- ✅ `functions/requirements.txt` - 必要なライブラリのリスト

---

## 🔍 それぞれのファイルの役割

### 1. `functions/main.py`

**役割：** Cloud Functionsの入口

**何をするか：**
1. Firebase Storageから動画をダウンロード
2. `analyze.py`の解析プログラムを呼ぶ
3. 結果を返す

**例えるなら：**
レストランの注文を受け付けるホールスタッフ
→ 注文（動画ファイル）を受け取って、キッチン（解析プログラム）に渡す

### 2. `functions/analyze.py`

**役割：** 実際に動画を解析する

**何をするか：**
1. MediaPipeで骨格を検出
2. パンチ速度、キック角度などを計算
3. スコア（0-100点）を算出
4. JSON形式で結果を返す

**例えるなら：**
レストランのシェフ
→ 食材（動画）を受け取って、料理（解析結果）を作る

### 3. `functions/requirements.txt`

**役割：** 必要な道具のリスト

**何をするか：**
Cloud Functionsに「このライブラリをインストールしてね」と伝える

---

## 🚀 次のステップ2: Dify APIと連携する

### ステップ2-1: Dify APIとは？

**Dify = AIKAのセリフを作ってくれるAI**

**例：**
解析結果：
- パンチ速度: 85点
- ガード姿勢: 72点
- キック高さ: 91点

↓ Dify APIに送る

↓

Difyが生成：
「ふふ、あなたのパンチ速度は85点ね。悪くないわ。でも、ガードが少し甘いわよ。その構えじゃ一瞬で倒れるわよ？」

### ステップ2-2: コードに追加する

`functions/main.py`に、以下の処理を追加：

1. 解析結果を受け取る
2. Dify APIに送る
3. AIKAのセリフを受け取る

---

## 🚀 ステップ3: LINE Messaging APIで送信

### ステップ3-1: LINE Messaging APIとは？

**LINEにメッセージを送るための仕組み**

**必要なもの：**
- Channel Access Token（LINEへの通行証のようなもの）

### ステップ3-2: コードに追加する

`functions/main.py`に、以下の処理を追加：

1. DifyからAIKAのセリフを受け取る
2. LINE Messaging APIでユーザーに送る

---

## 📊 全体の流れ（完成版）

```
┌─────────────┐
│  ユーザー   │ 「動画をアップロード」ボタンをクリック
└──────┬──────┘
       │
       ↓
┌─────────────────┐
│  LIFFアプリ     │ Firebase Storageにアップロード
└──────┬──────────┘
       │
       ↓ 【自動】
┌─────────────────┐
│ Cloud Functions │ main.pyが実行される
│  (main.py)      │ 1. 動画をダウンロード
└──────┬──────────┘ 2. analyze.pyで解析
       │
       ↓
┌─────────────────┐
│  analyze.py     │ スコア算出（JSON形式）
└──────┬──────────┘
       │
       ↓
┌─────────────────┐
│  Dify API       │ AIKAのセリフ生成
└──────┬──────────┘
       │
       ↓
┌─────────────────┐
│ LINE Messaging  │ ユーザーに送信
│      API        │
└──────┬──────────┘
       │
       ↓
┌─────────────┐
│  ユーザー   │ LINEで結果を受け取る ✨
└─────────────┘
```

---

## ✅ 現在の状況

### ステップ1: 完了 ✅
- [x] Cloud Functionsの基本構造

### ステップ2: これから ⏳
- [ ] Dify API連携のコード追加
- [ ] 環境変数の設定（APIキーなど）

### ステップ3: これから ⏳
- [ ] LINE Messaging API連携のコード追加
- [ ] 環境変数の設定（Channel Access Token）

### ステップ4: 最後 ⏳
- [ ] Firebase Storageトリガーの設定
- [ ] Cloud Functionsのデプロイ
- [ ] テスト実行

---

## 🎯 次にやること

**オプションA: Dify API連携を追加**
→ `functions/main.py`にDify API呼び出しのコードを追加

**オプションB: LINE API連携を追加**
→ `functions/main.py`にLINE Messaging API呼び出しのコードを追加

**オプションC: すべて一気に追加**
→ 両方のAPI連携を一度に追加

どれから進めますか？

